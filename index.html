<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CN Console ‚Äî The Briefcase</title>

  <!-- üåû Sunday App Framework - Core CSS -->
  <link rel="stylesheet" href="/sundayapp/css/tokens.css">
  <link rel="stylesheet" href="/sundayapp/css/base.css">
  <link rel="stylesheet" href="/sundayapp/css/utilities.css">

  <!-- Sunday Standard primitives (for `sunday-*` classes) -->
  <link rel="stylesheet" href="/sundayapp/css/console-primitives.css">
  <link rel="stylesheet" href="/sundayapp/css/console-shell.css">
  <link rel="stylesheet" href="/sundayapp/css/components/tabs.css">

  <!-- CN Console overrides -->
  <link rel="stylesheet" href="css/ai-console.css?v=20251222a">
  <link rel="stylesheet" href="css/briefcase-library.css?v=20251222a">
  
  <style>
    /* Auth page styles - hide all navigation chrome on login/register pages */
    body.auth-page .global-header,
    body.auth-page .tabs-container,
    body.auth-page .fab-button,
    body.auth-page .fab-container,
    body.auth-page [class*="fab"],
    body.auth-page #global-header-container,
    body.auth-page #mainTabs,
    body.auth-page .auth-hide,
    html.is-auth-page .global-header,
    html.is-auth-page .tabs-container,
    html.is-auth-page .fab-button,
    html.is-auth-page .fab-container,
    html.is-auth-page [class*="fab"],
    html.is-auth-page #global-header-container,
    html.is-auth-page #mainTabs,
    html.is-auth-page .auth-hide {
      display: none !important;
      visibility: hidden !important;
      opacity: 0 !important;
      pointer-events: none !important;
    }
    body.auth-page #contentContainer,
    html.is-auth-page #contentContainer {
      padding-top: 0 !important;
      margin-top: 0 !important;
    }
  </style>
  
  <!-- EARLY AUTH DETECTION - Runs before body renders to prevent flash -->
  <script>
    (function() {
      var hash = window.location.hash || '';
      // Detect all auth-related routes (with or without leading slash)
      var isAuth = hash.indexOf('cartridge/auth') !== -1 || 
                   hash.indexOf('/login') !== -1 || 
                   hash.indexOf('/register') !== -1 ||
                   hash === '#login' ||
                   hash === '#register' ||
                   hash.indexOf('#login') !== -1 ||
                   hash.indexOf('#register') !== -1 ||
                   hash.indexOf('forgot-password') !== -1 ||
                   hash.indexOf('reset-password') !== -1;
      if (isAuth) {
        document.documentElement.classList.add('is-auth-page');
      }
    })();
  </script>
</head>
<body>
  <!-- Auth Page Detection - Hide UI chrome on login/register pages -->
  <script>
    (function() {
      function updateAuthPageUI() {
        const hash = window.location.hash || '';
        const route = hash.replace(/^#\/?/, ''); // Remove # and optional /
        const isAuthPage = hash.includes('cartridge/auth') || 
                           hash.includes('/login') ||
                           hash.includes('/register') ||
                           hash.includes('forgot-password') ||
                           hash.includes('reset-password') ||
                           route === 'login' ||
                           route === 'register' ||
                           route.startsWith('login') ||
                           route.startsWith('register');
        
        document.documentElement.classList.toggle('is-auth-page', isAuthPage);
        document.body.classList.toggle('auth-page', isAuthPage);
        
        const elementsToHide = document.querySelectorAll(
          '.global-header, .tabs-container, .fab-button, .fab-container, #global-header-container, #mainTabs, .auth-hide'
        );
        elementsToHide.forEach(el => {
          if (isAuthPage) {
            el.style.cssText = 'display: none !important; visibility: hidden !important;';
          } else {
            el.style.cssText = '';
          }
        });
      }
      
      updateAuthPageUI();
      window.addEventListener('hashchange', updateAuthPageUI);
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', updateAuthPageUI);
      }
      const observer = new MutationObserver(updateAuthPageUI);
      observer.observe(document.documentElement, { childList: true, subtree: true });
      setTimeout(updateAuthPageUI, 0);
      setTimeout(updateAuthPageUI, 100);
      setTimeout(updateAuthPageUI, 300);
      setTimeout(updateAuthPageUI, 500);
      setTimeout(updateAuthPageUI, 1000);
    })();
  </script>

  <div id="global-header-container" class="global-header auth-hide"></div>

  <div class="tabs-container auth-hide">
    <!-- Pre-render tabs so navigation is visible even if JS fails -->
    <div class="tabs" id="mainTabs">
      <a class="tab-btn" href="#overview" data-tab="overview" data-route="overview">
        <span class="tab-icon">üèõÔ∏è</span>
        <span class="tab-label">Overview</span>
      </a>
      <a class="tab-btn" href="#contributions" data-tab="contributions" data-route="contributions">
        <span class="tab-icon">üß©</span>
        <span class="tab-label">Contributions</span>
      </a>
      <a class="tab-btn" href="#protocols" data-tab="protocols" data-route="protocols">
        <span class="tab-icon">üìú</span>
        <span class="tab-label">Protocols</span>
      </a>
      <a class="tab-btn" href="#ai" data-tab="ai" data-route="ai">
        <span class="tab-icon">ü§ñ</span>
        <span class="tab-label">AI</span>
      </a>
      <a class="tab-btn" href="#settings" data-tab="settings" data-route="settings">
        <span class="tab-icon">‚öôÔ∏è</span>
        <span class="tab-label">Settings</span>
      </a>
    </div>
  </div>

  <div id="contentContainer" class="content-container">
    <div id="cnBootStatus" class="sunday-card">
      <div class="sunday-card__body">
        <div class="sunday-text sunday-text--title">CN Console ‚Äî The Briefcase</div>
        <div class="sunday-text sunday-text--muted">Loading Contribution Network OS‚Ä¶</div>
      </div>
    </div>
  </div>

  <noscript>
    <div class="sunday-card" style="max-width:720px;margin:24px auto;">
      <div class="sunday-card__header">
        <div class="sunday-text sunday-text--title">JavaScript is disabled</div>
        <div class="sunday-text sunday-text--muted">CN Console requires JavaScript to run.</div>
      </div>
      <div class="sunday-card__body">
        <div class="sunday-text">Enable JavaScript, then reload this page.</div>
      </div>
    </div>
  </noscript>

  <!-- Bootstrap runs as an external module to avoid inline-script blockers -->
  <script type="module" src="./js/cn-boot.js?v=20251222a"></script>
  <script type="module" src="./js/cn-cartridges.js?v=20251222a"></script>

  <script nomodule>
    window.__CN_NO_MODULE = true;
    try {
      const container = document.getElementById('contentContainer');
      if (container) {
        container.innerHTML = `
          <div class="sunday-card" style="max-width:720px;margin:24px auto;">
            <div class="sunday-card__header">
              <div class="sunday-text sunday-text--title">Browser not supported</div>
              <div class="sunday-text sunday-text--muted">This console requires a browser with ES Modules support.</div>
            </div>
            <div class="sunday-card__body">
              <div class="sunday-text">Open this site in the latest Chrome, Firefox, Safari, or Edge.</div>
            </div>
          </div>
        `;
      }
    } catch {}
  </script>

  <!-- If modules are supported but the module failed to load/run, show a clear error. -->
  <script>
    setTimeout(function () {
      try {
        if (window.__CN_BOOT_OK === true) return;
        if (window.__CN_NO_MODULE) return;
        const container = document.getElementById('contentContainer');
        if (!container) return;
        container.innerHTML = `
          <div class="sunday-card" style="max-width:720px;margin:24px auto;">
            <div class="sunday-card__header">
              <div class="sunday-text sunday-text--title">CN Console ‚Äî The Briefcase didn't start</div>
              <div class="sunday-text sunday-text--muted">The browser supports modules, but the boot module did not run.</div>
            </div>
            <div class="sunday-card__body">
              <div class="sunday-text">Try a hard reload. If it persists, check for script blockers/extensions or try another browser.</div>
            </div>
          </div>
        `;
      } catch {}
    }, 2500);
  </script>
</body>
</html>
