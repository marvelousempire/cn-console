<!-- 
  üß© CN Console - Login Page
  Modern login interface matching Quick Server style
-->

<div class="auth-page login-page">
  <div class="auth-container">
    <!-- Logo & Title -->
    <div class="auth-header">
      <div class="auth-logo">üß©</div>
      <h1 class="auth-title">CN Console</h1>
      <p class="auth-subtitle">Sign in to access Contribution Network</p>
    </div>

    <!-- Login Form -->
    <form id="cnLoginForm" class="auth-form">
      <div class="form-group">
        <label for="cnEmail">Email</label>
        <input type="email" id="cnEmail" name="email" placeholder="admin@thebriefcase.app" autocomplete="email" required />
      </div>

      <div class="form-group">
        <label for="cnPassword">Password</label>
        <div class="password-input">
          <input type="password" id="cnPassword" name="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" required />
          <button type="button" class="toggle-password" aria-label="Toggle password visibility">
            üëÅÔ∏è
          </button>
        </div>
      </div>

      <div class="form-row">
        <label class="checkbox-label">
          <input type="checkbox" id="cnRemember" name="rememberMe" />
          <span>Remember me</span>
        </label>
        <a href="#forgot-password" class="link-forgot">
          Forgot password?
        </a>
      </div>

      <button type="submit" class="btn btn-primary btn-block" id="cnLoginBtn">
        <span class="btn-text">Sign In</span>
        <span class="btn-loading" style="display:none">‚è≥ Signing in...</span>
      </button>

      <div id="cnLoginError" class="form-error" style="display:none"></div>
    </form>

    <!-- Footer -->
    <div class="auth-footer">
      <p>Don't have an account? <a href="#register">Create one</a></p>
    </div>
  </div>

  <!-- Background decoration -->
  <div class="auth-background">
    <div class="auth-bg-gradient"></div>
  </div>
</div>

<style>
  /* Auth Page Layout - Full screen centered */
  .auth-page {
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--sunday-bg, #0b0c10);
    z-index: 1000;
  }

  .auth-container {
    position: relative;
    z-index: 2;
    width: 100%;
    max-width: 400px;
    padding: 40px;
    background: var(--sunday-surface, #0f131c);
    border: 1px solid var(--sunday-line, #1e2636);
    border-radius: 16px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
  }

  /* Header */
  .auth-header {
    text-align: center;
    margin-bottom: 32px;
  }

  .auth-logo {
    font-size: 56px;
    margin-bottom: 16px;
    animation: glow 3s ease infinite;
  }

  .auth-title {
    font-size: 24px;
    font-weight: 700;
    color: var(--sunday-text, #e9f3ff);
    margin: 0 0 8px;
  }

  .auth-subtitle {
    color: var(--sunday-text-muted, #9bb1c7);
    margin: 0;
    font-size: 14px;
  }

  /* Form */
  .auth-form {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .form-group label {
    font-size: 13px;
    font-weight: 500;
    color: var(--sunday-text-muted, #9bb1c7);
  }

  .form-group input {
    padding: 12px 16px;
    background: var(--sunday-bg, #0b0c10);
    border: 1px solid var(--sunday-line, #1e2636);
    border-radius: 8px;
    color: var(--sunday-text, #e9f3ff);
    font-size: 14px;
    transition: border-color 0.2s, box-shadow 0.2s;
  }

  .form-group input:focus {
    outline: none;
    border-color: var(--sunday-accent, #7ce3ff);
    box-shadow: 0 0 0 3px rgba(124, 227, 255, 0.1);
  }

  .form-group input::placeholder {
    color: var(--sunday-text-muted, #9bb1c7);
    opacity: 0.5;
  }

  .password-input {
    position: relative;
  }

  .password-input input {
    width: 100%;
    padding-right: 48px;
  }

  .toggle-password {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    cursor: pointer;
    font-size: 16px;
    opacity: 0.6;
    transition: opacity 0.2s;
  }

  .toggle-password:hover {
    opacity: 1;
  }

  .form-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 13px;
  }

  .checkbox-label {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    color: var(--sunday-text-muted, #9bb1c7);
  }

  .checkbox-label input[type="checkbox"] {
    width: 16px;
    height: 16px;
    accent-color: var(--sunday-accent, #7ce3ff);
  }

  .link-forgot {
    color: var(--sunday-accent, #7ce3ff);
    text-decoration: none;
    transition: opacity 0.2s;
  }

  .link-forgot:hover {
    opacity: 0.8;
  }

  .btn-block {
    width: 100%;
    padding: 14px;
    font-size: 15px;
    font-weight: 600;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-primary {
    background: linear-gradient(135deg, var(--sunday-brand, #8b5cf6), var(--sunday-accent, #7ce3ff));
    border: none;
    color: white;
  }

  .btn-primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
  }

  .btn-primary:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
  }

  .form-error {
    padding: 12px 16px;
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
    border-radius: 8px;
    color: #ef4444;
    font-size: 13px;
    text-align: center;
  }

  /* Footer */
  .auth-footer {
    margin-top: 24px;
    text-align: center;
    font-size: 13px;
    color: var(--sunday-text-muted, #9bb1c7);
  }

  .auth-footer a {
    color: var(--sunday-accent, #7ce3ff);
    text-decoration: none;
    font-weight: 500;
  }

  /* Background */
  .auth-background {
    position: absolute;
    inset: 0;
    z-index: 1;
    overflow: hidden;
  }

  .auth-bg-gradient {
    position: absolute;
    width: 600px;
    height: 600px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: radial-gradient(circle, rgba(139, 92, 246, 0.15) 0%, transparent 70%);
    filter: blur(60px);
  }

  @keyframes glow {
    0%, 100% {
      filter: drop-shadow(0 0 10px rgba(139, 92, 246, 0.3));
    }
    50% {
      filter: drop-shadow(0 0 20px rgba(139, 92, 246, 0.6));
    }
  }
</style>

<script>
  (function() {
    'use strict';
    
    // Mark this as a bound page to prevent re-initialization
    const page = document.querySelector('.auth-page.login-page');
    if (!page || page.dataset.cnBound === '1') return;
    page.dataset.cnBound = '1';

    // DOM Elements
    const form = document.getElementById('cnLoginForm');
    const emailInput = document.getElementById('cnEmail');
    const passwordInput = document.getElementById('cnPassword');
    const rememberMeInput = document.getElementById('cnRemember');
    const loginBtn = document.getElementById('cnLoginBtn');
    const errorDiv = document.getElementById('cnLoginError');
    const togglePasswordBtn = document.querySelector('.toggle-password');

    // Toggle password visibility
    togglePasswordBtn?.addEventListener('click', () => {
      const type = passwordInput.type === 'password' ? 'text' : 'password';
      passwordInput.type = type;
      togglePasswordBtn.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
    });

    // Form submission
    form?.addEventListener('submit', async (e) => {
      e.preventDefault();

      const email = emailInput.value.trim();
      const password = passwordInput.value;
      const rememberMe = rememberMeInput?.checked || false;

      if (!email || !password) {
        showError('Please enter email and password');
        return;
      }

      setLoading(true);
      hideError();

      try {
        const { getAuthClient } = await import('/core/auth-client.js');
        const auth = getAuthClient();

        await auth.login(email, password, rememberMe);

        // Show success briefly
        const btnText = loginBtn.querySelector('.btn-text');
        if (btnText) btnText.textContent = '‚úì Success!';

        // Mark as authenticated and show app
        document.documentElement.classList.add('authenticated');
        document.documentElement.classList.remove('show-login', 'is-auth-page');
        document.body.classList.remove('auth-page');

        // Redirect
        setTimeout(() => {
          const redirect = sessionStorage.getItem('sunday_redirect_after_login') || '#overview';
          sessionStorage.removeItem('sunday_redirect_after_login');
          window.location.hash = redirect;
          // Reload to fully initialize app after login
          window.location.reload();
        }, 500);

      } catch (error) {
        showError(error.message || 'Login failed. Please try again.');
        setLoading(false);
      }
    });

    function setLoading(loading) {
      if (!loginBtn) return;
      loginBtn.disabled = loading;
      const btnText = loginBtn.querySelector('.btn-text');
      const btnLoading = loginBtn.querySelector('.btn-loading');
      if (btnText) btnText.style.display = loading ? 'none' : 'inline';
      if (btnLoading) btnLoading.style.display = loading ? 'inline' : 'none';
    }

    function showError(message) {
      if (!errorDiv) return;
      errorDiv.textContent = message;
      errorDiv.style.display = 'block';
    }

    function hideError() {
      if (!errorDiv) return;
      errorDiv.style.display = 'none';
    }

    // Focus email on load
    try { emailInput?.focus(); } catch {}
  })();
</script>
