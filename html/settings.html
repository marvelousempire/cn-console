<!--
  ü§ù CN Console ‚Äî Settings Page
  
  Hybrid Layout (SOP-APP-008):
  - Sidebar with section navigation
  - Sub-tabs for detailed content
  - Content panel with settings cards
  
  Created: December 2025
  Last Updated: Tuesday Dec 23, 2025
-->

<div class="hybrid-settings-page">
  <style>
    /* === HYBRID SETTINGS LAYOUT === */
    .hybrid-settings-page {
      display: grid;
      grid-template-columns: 240px 1fr;
      gap: 0;
      min-height: calc(100vh - 120px);
      background: var(--bg);
    }
    
    /* === SIDEBAR === */
    .hybrid-sidebar {
      background: var(--surface);
      border-right: 1px solid var(--border);
      padding: 20px 0;
      display: flex;
      flex-direction: column;
    }
    
    .hybrid-sidebar-header {
      padding: 0 20px 16px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 16px;
    }
    
    .hybrid-sidebar-title {
      font-size: 18px;
      font-weight: 800;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .hybrid-sidebar-subtitle {
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
    }
    
    .hybrid-version-badge {
      padding: 3px 8px;
      border-radius: 6px;
      font-size: 10px;
      font-weight: 800;
      background: var(--accent);
      color: var(--bg);
    }
    
    .hybrid-sidebar-nav {
      flex: 1;
      overflow-y: auto;
    }
    
    .hybrid-nav-section {
      padding: 0 12px;
      margin-bottom: 16px;
    }
    
    .hybrid-nav-section-title {
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--muted);
      padding: 8px 8px 4px;
    }
    
    .hybrid-nav-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.15s;
      font-size: 13px;
      font-weight: 600;
      color: var(--ink);
      text-decoration: none;
    }
    
    .hybrid-nav-item:hover {
      background: var(--bg);
    }
    
    .hybrid-nav-item.active {
      background: color-mix(in srgb, var(--accent) 15%, transparent);
      color: var(--accent);
    }
    
    .hybrid-nav-icon {
      font-size: 16px;
      width: 20px;
      text-align: center;
    }
    
    /* === MAIN CONTENT === */
    .hybrid-main {
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    
    /* === HEADER BAR === */
    .hybrid-header-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 24px;
      border-bottom: 1px solid var(--border);
      background: var(--surface);
    }
    
    .hybrid-header-title {
      font-size: 16px;
      font-weight: 800;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .hybrid-header-actions {
      display: flex;
      gap: 8px;
    }
    
    .hybrid-btn {
      padding: 8px 14px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--surface);
      color: var(--ink);
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.15s;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .hybrid-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
    }
    
    .hybrid-btn.primary {
      background: var(--accent);
      color: var(--bg);
      border-color: var(--accent);
    }
    
    .hybrid-btn.danger {
      background: #ef4444;
      color: white;
      border-color: #ef4444;
    }
    
    /* === CONTENT AREA === */
    .hybrid-content {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
    }
    
    .hybrid-panel {
      display: none;
      max-width: 900px;
    }
    
    .hybrid-panel.active {
      display: block;
    }
    
    .hybrid-panel-header {
      margin-bottom: 24px;
    }
    
    .hybrid-panel-title {
      font-size: 20px;
      font-weight: 800;
      margin: 0;
    }
    
    .hybrid-panel-desc {
      font-size: 14px;
      color: var(--muted);
      margin-top: 6px;
      line-height: 1.5;
    }
    
    /* === CARDS === */
    .hybrid-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      margin-bottom: 16px;
    }
    
    .hybrid-card-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
    }
    
    .hybrid-card-title {
      font-size: 14px;
      font-weight: 700;
    }
    
    .hybrid-card-body {
      padding: 16px 20px;
    }
    
    .hybrid-setting-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid var(--border);
    }
    
    .hybrid-setting-row:last-child {
      border-bottom: none;
    }
    
    .hybrid-setting-info {
      flex: 1;
      min-width: 0;
    }
    
    .hybrid-setting-label {
      font-weight: 600;
      font-size: 13px;
    }
    
    .hybrid-setting-desc {
      font-size: 12px;
      color: var(--muted);
      margin-top: 2px;
    }
    
    .hybrid-setting-control {
      margin-left: 20px;
    }
    
    /* === ADDONS === */
    .addon-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 14px;
      background: var(--bg);
      border-radius: 10px;
      margin-bottom: 10px;
    }
    
    .addon-icon {
      font-size: 24px;
    }
    
    .addon-info {
      flex: 1;
    }
    
    .addon-name {
      font-weight: 700;
      font-size: 13px;
    }
    
    .addon-desc {
      font-size: 12px;
      color: var(--muted);
      margin-top: 2px;
    }
    
    .addon-toggle {
      position: relative;
      width: 44px;
      height: 24px;
    }
    
    .addon-toggle input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .addon-slider {
      position: absolute;
      cursor: pointer;
      inset: 0;
      background: var(--border);
      border-radius: 24px;
      transition: 0.2s;
    }
    
    .addon-slider:before {
      content: "";
      position: absolute;
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background: white;
      border-radius: 50%;
      transition: 0.2s;
    }
    
    .addon-toggle input:checked + .addon-slider {
      background: var(--accent);
    }
    
    .addon-toggle input:checked + .addon-slider:before {
      transform: translateX(20px);
    }
    
    /* === DIAGNOSTICS === */
    .diag-row {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid var(--border);
      font-size: 13px;
    }
    
    .diag-row:last-child {
      border-bottom: none;
    }
    
    .diag-label {
      color: var(--muted);
    }
    
    .diag-value {
      font-weight: 600;
    }
    
    /* === RESPONSIVE === */
    @media (max-width: 768px) {
      .hybrid-settings-page {
        grid-template-columns: 1fr;
      }
      .hybrid-sidebar {
        display: none;
      }
    }
  </style>

  <!-- SIDEBAR -->
  <aside class="hybrid-sidebar">
    <div class="hybrid-sidebar-header">
      <div class="hybrid-sidebar-title">
        <span>‚öôÔ∏è</span>
        <span>Settings</span>
        <span class="hybrid-version-badge" id="settingsVersion">v1.3.0</span>
      </div>
      <div class="hybrid-sidebar-subtitle">Configure CN Console</div>
    </div>
    
    <nav class="hybrid-sidebar-nav">
      <div class="hybrid-nav-section">
        <div class="hybrid-nav-section-title">General</div>
        <a class="hybrid-nav-item active" data-section="addons">
          <span class="hybrid-nav-icon">üß©</span>
          <span>Add-ons</span>
        </a>
        <a class="hybrid-nav-item" data-section="appearance">
          <span class="hybrid-nav-icon">üé®</span>
          <span>Appearance</span>
        </a>
        <a class="hybrid-nav-item" data-section="cache">
          <span class="hybrid-nav-icon">üóëÔ∏è</span>
          <span>Cache</span>
        </a>
      </div>
      
      <div class="hybrid-nav-section">
        <div class="hybrid-nav-section-title">Advanced</div>
        <a class="hybrid-nav-item" data-section="diagnostics">
          <span class="hybrid-nav-icon">üíö</span>
          <span>Diagnostics</span>
        </a>
        <a class="hybrid-nav-item" data-section="api">
          <span class="hybrid-nav-icon">üîå</span>
          <span>API</span>
        </a>
      </div>
    </nav>
  </aside>

  <!-- MAIN CONTENT -->
  <main class="hybrid-main">
    <!-- HEADER BAR -->
    <div class="hybrid-header-bar">
      <div class="hybrid-header-title">
        <span id="sectionTitle">üß© Add-ons</span>
      </div>
      <div class="hybrid-header-actions">
        <button class="hybrid-btn" id="cnExportSettings">üì• Export</button>
        <button class="hybrid-btn primary" id="cnApplyAddons">üîÑ Apply</button>
        <button class="hybrid-btn danger" id="cnResetSettings">‚Ü©Ô∏è Reset</button>
      </div>
    </div>
    
    <!-- CONTENT PANELS -->
    <div class="hybrid-content">
      
      <!-- ADDONS SECTION -->
      <div class="hybrid-panel active" data-section="addons">
        <div class="hybrid-panel-header">
          <h2 class="hybrid-panel-title">Console Add-ons</h2>
          <p class="hybrid-panel-desc">Pick UI features to enable or disable. Changes apply after clicking "Apply".</p>
        </div>
        
        <div class="hybrid-card">
          <div class="hybrid-card-body" id="cnAddonsList">
            <div class="addon-item">
              <span class="addon-icon">‚ö°</span>
              <div class="addon-info">
                <div class="addon-name">Quick Actions Button</div>
                <div class="addon-desc">Floating action button for fast access to common tasks</div>
              </div>
              <label class="addon-toggle">
                <input type="checkbox" data-addon="quick-actions" checked>
                <span class="addon-slider"></span>
              </label>
            </div>
            
            <div class="addon-item">
              <span class="addon-icon">üìã</span>
              <div class="addon-info">
                <div class="addon-name">Version Badge</div>
                <div class="addon-desc">Shows current version and changelog in header</div>
              </div>
              <label class="addon-toggle">
                <input type="checkbox" data-addon="version-badge" checked>
                <span class="addon-slider"></span>
              </label>
            </div>
            
            <div class="addon-item">
              <span class="addon-icon">üîî</span>
              <div class="addon-info">
                <div class="addon-name">Notifications</div>
                <div class="addon-desc">Toast notifications for actions and updates</div>
              </div>
              <label class="addon-toggle">
                <input type="checkbox" data-addon="notifications" checked>
                <span class="addon-slider"></span>
              </label>
            </div>
          </div>
        </div>
      </div>
      
      <!-- APPEARANCE SECTION -->
      <div class="hybrid-panel" data-section="appearance">
        <div class="hybrid-panel-header">
          <h2 class="hybrid-panel-title">Appearance</h2>
          <p class="hybrid-panel-desc">Customize how the console looks.</p>
        </div>
        
        <div class="hybrid-card">
          <div class="hybrid-card-header">
            <div class="hybrid-card-title">Theme</div>
          </div>
          <div class="hybrid-card-body">
            <div class="hybrid-setting-row">
              <div class="hybrid-setting-info">
                <div class="hybrid-setting-label">Color Mode</div>
                <div class="hybrid-setting-desc">Choose dark or light mode</div>
              </div>
              <div class="hybrid-setting-control">
                <select class="sunday-input" id="themeMode" style="padding: 8px 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: var(--ink);">
                  <option value="dark">Dark</option>
                  <option value="light">Light</option>
                  <option value="auto">Auto (System)</option>
                </select>
              </div>
            </div>
            <div class="hybrid-setting-row">
              <div class="hybrid-setting-info">
                <div class="hybrid-setting-label">Accent Color</div>
                <div class="hybrid-setting-desc">The main highlight color</div>
              </div>
              <div class="hybrid-setting-control">
                <input type="color" id="accentColor" value="#8b5cf6" style="width: 40px; height: 32px; border: none; border-radius: 6px; cursor: pointer;">
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- CACHE SECTION -->
      <div class="hybrid-panel" data-section="cache">
        <div class="hybrid-panel-header">
          <h2 class="hybrid-panel-title">Cache & Storage</h2>
          <p class="hybrid-panel-desc">Clear browser cache when things seem stuck or outdated.</p>
        </div>
        
        <div class="hybrid-card">
          <div class="hybrid-card-header">
            <div class="hybrid-card-title">Cache Controls</div>
          </div>
          <div class="hybrid-card-body">
            <p style="font-size: 13px; color: var(--muted); margin: 0 0 16px;">
              Use this when the browser is stuck on old JS/CSS. It clears service worker + CacheStorage and reloads.
            </p>
            <button class="hybrid-btn danger" id="cnClearCache" style="width: 100%;">
              üóëÔ∏è Clear Cache + Reload
            </button>
          </div>
        </div>
        
        <div class="hybrid-card">
          <div class="hybrid-card-header">
            <div class="hybrid-card-title">Local Storage</div>
          </div>
          <div class="hybrid-card-body">
            <div class="hybrid-setting-row">
              <div class="hybrid-setting-info">
                <div class="hybrid-setting-label">Settings Storage Key</div>
                <div class="hybrid-setting-desc">Where this console's settings are stored</div>
              </div>
              <div class="hybrid-setting-control">
                <code style="font-size: 12px; background: var(--bg); padding: 4px 8px; border-radius: 4px;">cn-console-settings</code>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- DIAGNOSTICS SECTION -->
      <div class="hybrid-panel" data-section="diagnostics">
        <div class="hybrid-panel-header">
          <h2 class="hybrid-panel-title">Diagnostics</h2>
          <p class="hybrid-panel-desc">Useful information for debugging.</p>
        </div>
        
        <div class="hybrid-card">
          <div class="hybrid-card-header">
            <div class="hybrid-card-title">Console Info</div>
          </div>
          <div class="hybrid-card-body">
            <div class="diag-row">
              <span class="diag-label">Console Name</span>
              <span class="diag-value" id="diagConsole">CN Console</span>
            </div>
            <div class="diag-row">
              <span class="diag-label">Console Version</span>
              <span class="diag-value" id="diagVersion">1.3.0</span>
            </div>
            <div class="diag-row">
              <span class="diag-label">Framework</span>
              <span class="diag-value">SundayApp 2.4.0</span>
            </div>
            <div class="diag-row">
              <span class="diag-label">UDIN</span>
              <span class="diag-value" style="font-family: monospace; font-size: 11px;">CONSOLE-CN-20251223120000</span>
            </div>
          </div>
        </div>
        
        <div class="hybrid-card">
          <div class="hybrid-card-header">
            <div class="hybrid-card-title">Environment</div>
          </div>
          <div class="hybrid-card-body">
            <div class="diag-row">
              <span class="diag-label">Host</span>
              <span class="diag-value" id="diagHost">-</span>
            </div>
            <div class="diag-row">
              <span class="diag-label">Path</span>
              <span class="diag-value" id="diagPath">-</span>
            </div>
            <div class="diag-row">
              <span class="diag-label">Protocol</span>
              <span class="diag-value" id="diagProtocol">-</span>
            </div>
            <div class="diag-row">
              <span class="diag-label">User Agent</span>
              <span class="diag-value" id="diagUA" style="font-size: 11px; word-break: break-all;">-</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- API SECTION -->
      <div class="hybrid-panel" data-section="api">
        <div class="hybrid-panel-header">
          <h2 class="hybrid-panel-title">API Settings</h2>
          <p class="hybrid-panel-desc">Configure API connections and endpoints.</p>
        </div>
        
        <div class="hybrid-card">
          <div class="hybrid-card-header">
            <div class="hybrid-card-title">API Base URL</div>
          </div>
          <div class="hybrid-card-body">
            <div class="hybrid-setting-row">
              <div class="hybrid-setting-info">
                <div class="hybrid-setting-label">Base URL</div>
                <div class="hybrid-setting-desc">The root URL for API requests</div>
              </div>
              <div class="hybrid-setting-control">
                <code style="font-size: 12px; background: var(--bg); padding: 4px 8px; border-radius: 4px;">/api</code>
              </div>
            </div>
          </div>
        </div>
        
        <div class="hybrid-card">
          <div class="hybrid-card-header">
            <div class="hybrid-card-title">Health Check</div>
          </div>
          <div class="hybrid-card-body">
            <div class="hybrid-setting-row">
              <div class="hybrid-setting-info">
                <div class="hybrid-setting-label">Endpoint</div>
                <div class="hybrid-setting-desc">Health check URL</div>
              </div>
              <div class="hybrid-setting-control">
                <code style="font-size: 12px; background: var(--bg); padding: 4px 8px; border-radius: 4px;">/health</code>
              </div>
            </div>
            <div class="hybrid-setting-row">
              <div class="hybrid-setting-info">
                <div class="hybrid-setting-label">Status</div>
                <div class="hybrid-setting-desc">Current health check status</div>
              </div>
              <div class="hybrid-setting-control">
                <span style="color: #10b981; font-weight: 600;">‚óè Healthy</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
    </div>
  </main>
</div>

<script>
  (function() {
    const panels = document.querySelectorAll('.hybrid-panel');
    const navItems = document.querySelectorAll('.hybrid-nav-item');
    const sectionTitle = document.getElementById('sectionTitle');
    
    // Section titles with icons
    const sectionTitles = {
      addons: 'üß© Add-ons',
      appearance: 'üé® Appearance',
      cache: 'üóëÔ∏è Cache & Storage',
      diagnostics: 'üíö Diagnostics',
      api: 'üîå API Settings'
    };
    
    // Sidebar navigation
    navItems.forEach(item => {
      item.addEventListener('click', function(e) {
        e.preventDefault();
        
        // Update active nav item
        navItems.forEach(i => i.classList.remove('active'));
        this.classList.add('active');
        
        // Show corresponding panel
        const section = this.dataset.section;
        panels.forEach(panel => {
          panel.classList.remove('active');
          if (panel.dataset.section === section) {
            panel.classList.add('active');
          }
        });
        
        // Update header title
        sectionTitle.textContent = sectionTitles[section] || section;
      });
    });
    
    // Populate diagnostics
    document.getElementById('diagHost').textContent = window.location.host;
    document.getElementById('diagPath').textContent = window.location.pathname;
    document.getElementById('diagProtocol').textContent = window.location.protocol.replace(':', '');
    document.getElementById('diagUA').textContent = navigator.userAgent;
    
    // Clear cache button
    document.getElementById('cnClearCache').addEventListener('click', async function() {
      try {
        // Clear service worker caches
        if ('caches' in window) {
          const keys = await caches.keys();
          await Promise.all(keys.map(key => caches.delete(key)));
        }
        
        // Unregister service workers
        if ('serviceWorker' in navigator) {
          const registrations = await navigator.serviceWorker.getRegistrations();
          await Promise.all(registrations.map(reg => reg.unregister()));
        }
        
        // Force reload
        window.location.reload(true);
      } catch (err) {
        console.error('Cache clear failed:', err);
        window.location.reload(true);
      }
    });
    
    // Apply button
    document.getElementById('cnApplyAddons').addEventListener('click', function() {
      // Save settings to localStorage with storageKey
      const settings = {};
      document.querySelectorAll('[data-addon]').forEach(input => {
        settings[input.dataset.addon] = input.checked;
      });
      localStorage.setItem('cn-console-settings', JSON.stringify(settings));
      
      // Show feedback
      alert('Settings applied! Reload to see changes.');
    });
    
    // Reset button
    document.getElementById('cnResetSettings').addEventListener('click', function() {
      if (confirm('Reset all settings to defaults?')) {
        localStorage.removeItem('cn-console-settings');
        window.location.reload();
      }
    });
    
    // Export button
    document.getElementById('cnExportSettings').addEventListener('click', function() {
      const settings = localStorage.getItem('cn-console-settings') || '{}';
      const blob = new Blob([settings], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'cn-console-settings.json';
      a.click();
      URL.revokeObjectURL(url);
    });
    
    // Load saved settings
    try {
      const saved = JSON.parse(localStorage.getItem('cn-console-settings') || '{}');
      Object.entries(saved).forEach(([key, value]) => {
        const input = document.querySelector(`[data-addon="${key}"]`);
        if (input) input.checked = value;
      });
    } catch (e) {}
  })();
</script>
