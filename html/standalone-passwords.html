<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üîê Passwords Console - Quick Server</title>

  <!-- Basic Styles -->
  <link rel="stylesheet" href="/css/tokens.css">
  <link rel="stylesheet" href="/css/base.css">
  <link rel="stylesheet" href="/css/utilities.css">

  <style>
    /* Passwords Console Styles */
    .pwd-shell { max-width: 1400px; margin: 0 auto; padding: 24px; }

    .pwd-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
      flex-wrap: wrap;
      gap: 16px;
    }

    .pwd-title { display: flex; align-items: center; gap: 12px; }
    .pwd-title h1 { margin: 0; font-size: 28px; font-weight: 800; color: var(--ink); }
    .pwd-title-icon { font-size: 32px; }

    .pwd-actions { display: flex; gap: 8px; flex-wrap: wrap; }

    .pwd-btn {
      padding: 10px 16px;
      border-radius: 8px;
      border: 1px solid var(--line);
      background: var(--bg);
      color: var(--ink);
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .pwd-btn:hover { border-color: var(--brand); }
    .pwd-btn.primary { background: linear-gradient(135deg, #ef4444, #dc2626); color: white; border: none; }
    .pwd-btn.success { background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; }
    .pwd-btn.warning { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; border: none; }

    /* Tabs */
    .pwd-tabs { display: flex; gap: 8px; margin: 20px 0 16px; flex-wrap: wrap; }
    .pwd-tab {
      padding: 10px 16px;
      border-radius: 10px;
      border: 1px solid var(--line);
      background: var(--bg);
      color: var(--ink);
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .pwd-tab:hover { border-color: var(--brand); }
    .pwd-tab.active { border-color: #ef4444; background: rgba(239, 68, 68, 0.1); color: #ef4444; }

    /* Cards */
    .pwd-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }

    .pwd-card {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 20px;
      transition: all 0.2s ease;
    }

    .pwd-card:hover { border-color: var(--brand); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }

    .pwd-card-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
    .pwd-card-title { font-size: 18px; font-weight: 700; color: var(--ink); display: flex; align-items: center; gap: 8px; }
    .pwd-card-icon { font-size: 20px; }

    .pwd-card-desc { color: var(--muted); font-size: 14px; margin-bottom: 16px; }

    /* Form Elements */
    .pwd-form-group { margin-bottom: 16px; }
    .pwd-form-label { display: block; font-size: 12px; font-weight: 700; color: var(--muted); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px; }

    .pwd-form-input {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--line);
      border-radius: 8px;
      background: var(--bg);
      color: var(--ink);
      font-size: 14px;
      transition: all 0.2s ease;
    }

    .pwd-form-input:focus { outline: none; border-color: #ef4444; box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1); }

    .pwd-password-strength {
      margin-top: 8px;
      height: 4px;
      background: var(--line);
      border-radius: 2px;
      overflow: hidden;
    }

    .pwd-strength-fill {
      height: 100%;
      transition: all 0.3s ease;
      border-radius: 2px;
    }

    .pwd-strength-weak { background: #ef4444; width: 33%; }
    .pwd-strength-medium { background: #f59e0b; width: 66%; }
    .pwd-strength-strong { background: #10b981; width: 100%; }

    /* Password Entry */
    .pwd-entry {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: var(--bg);
      border: 1px solid var(--line);
      border-radius: 8px;
      margin-bottom: 8px;
    }

    .pwd-entry-icon { font-size: 18px; min-width: 18px; }
    .pwd-entry-info { flex: 1; }
    .pwd-entry-name { font-weight: 600; color: var(--ink); }
    .pwd-entry-meta { font-size: 12px; color: var(--muted); }
    .pwd-entry-actions { display: flex; gap: 6px; }

    /* Modal */
    .pwd-modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .pwd-modal.show { display: flex; }

    .pwd-modal-content {
      width: min(500px, 90vw);
      background: var(--card);
      border-radius: 12px;
      border: 1px solid var(--line);
      max-height: 80vh;
      overflow: hidden;
    }

    .pwd-modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 20px;
      border-bottom: 1px solid var(--line);
    }

    .pwd-modal-title { font-size: 18px; font-weight: 700; color: var(--ink); }
    .pwd-modal-close { background: none; border: none; font-size: 20px; cursor: pointer; color: var(--muted); }

    .pwd-modal-body { padding: 20px; overflow-y: auto; max-height: calc(80vh - 120px); }

    /* Toast */
    .pwd-toast {
      position: fixed;
      top: 80px;
      right: 24px;
      padding: 12px 16px;
      border-radius: 8px;
      font-weight: 600;
      display: none;
      z-index: 1001;
    }

    .pwd-toast.show { display: block; }
    .pwd-toast.success { background: linear-gradient(135deg, #10b981, #059669); color: white; }
    .pwd-toast.error { background: linear-gradient(135deg, #ef4444, #dc2626); color: white; }

    /* Back to Main */
    .pwd-back { margin-bottom: 20px; }
    .pwd-back a {
      color: var(--brand);
      text-decoration: none;
      font-weight: 600;
    }
    .pwd-back a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <div class="pwd-shell">
    <div class="pwd-back">
      <a href="/">‚Üê Back to Quick Server</a>
    </div>

    <div class="pwd-header">
      <div class="pwd-title">
        <span class="pwd-title-icon">üîê</span>
        <h1>Passwords Console</h1>
      </div>
      <div class="pwd-actions">
        <button class="pwd-btn primary" id="pwdGenerate">üé≤ Generate</button>
        <button class="pwd-btn success" id="pwdCreate">‚ûï Create Entry</button>
        <button class="pwd-btn" id="pwdImport">üì• Import</button>
        <button class="pwd-btn warning" id="pwdAudit">üìä Audit</button>
      </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="pwd-tabs" id="pwdTabs">
      <button class="pwd-tab active" data-tab="vault">üè¶ Vault</button>
      <button class="pwd-tab" data-tab="generator">üé≤ Generator</button>
      <button class="pwd-tab" data-tab="users">üë• User Passwords</button>
      <button class="pwd-tab" data-tab="services">üîß Services</button>
      <button class="pwd-tab" data-tab="policies">üìã Policies</button>
      <button class="pwd-tab" data-tab="audit">üìà Audit Log</button>
    </div>

    <!-- Vault Tab -->
    <div class="pwd-tab-content" data-panel="vault">
      <div class="pwd-grid">
        <div class="pwd-card">
          <div class="pwd-card-header">
            <div class="pwd-card-title">
              <span class="pwd-card-icon">üîç</span>
              Search & Filter
            </div>
          </div>
          <div class="pwd-form-group">
            <input type="text" class="pwd-form-input" id="pwdSearch" placeholder="Search passwords..." />
          </div>
          <div style="display: flex; gap: 8px; flex-wrap: wrap;">
            <select class="pwd-form-input" style="flex: 1;" id="pwdCategoryFilter">
              <option value="">All Categories</option>
              <option value="personal">Personal</option>
              <option value="work">Work</option>
              <option value="finance">Finance</option>
              <option value="social">Social</option>
            </select>
            <select class="pwd-form-input" style="flex: 1;" id="pwdStrengthFilter">
              <option value="">All Strengths</option>
              <option value="weak">Weak</option>
              <option value="medium">Medium</option>
              <option value="strong">Strong</option>
            </select>
          </div>
        </div>

        <div class="pwd-card">
          <div class="pwd-card-header">
            <div class="pwd-card-title">
              <span class="pwd-card-icon">üìä</span>
              Statistics
            </div>
          </div>
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
            <div style="text-align: center;">
              <div style="font-size: 24px; font-weight: 700; color: var(--ink);" id="pwdTotalCount">0</div>
              <div style="font-size: 12px; color: var(--muted);">Total Entries</div>
            </div>
            <div style="text-align: center;">
              <div style="font-size: 24px; font-weight: 700; color: #10b981;" id="pwdStrongCount">0</div>
              <div style="font-size: 12px; color: var(--muted);">Strong Passwords</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Password Entries -->
      <div id="pwdEntries" style="margin-top: 24px;">
        <div class="pwd-card">
          <div style="text-align: center; padding: 40px; color: var(--muted);">
            <div style="font-size: 48px; margin-bottom: 16px;">üîê</div>
            <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">No Passwords Yet</div>
            <div style="margin-bottom: 20px;">Create your first password entry to get started</div>
            <button class="pwd-btn primary" onclick="document.getElementById('pwdCreate').click()">‚ûï Create Entry</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Generator Tab -->
    <div class="pwd-tab-content" data-panel="generator" style="display: none;">
      <div class="pwd-grid">
        <div class="pwd-card">
          <div class="pwd-card-header">
            <div class="pwd-card-title">
              <span class="pwd-card-icon">üé≤</span>
              Password Generator
            </div>
          </div>
          <div class="pwd-card-desc">Generate secure passwords with customizable options</div>

          <div class="pwd-form-group">
            <label class="pwd-form-label">Length</label>
            <input type="range" min="8" max="64" value="16" class="pwd-form-input" id="pwdLength" />
            <div style="display: flex; justify-content: space-between; font-size: 12px; color: var(--muted);">
              <span>8</span>
              <span id="pwdLengthValue">16</span>
              <span>64</span>
            </div>
          </div>

          <div class="pwd-form-group">
            <label style="display: flex; align-items: center; gap: 8px;">
              <input type="checkbox" id="pwdUppercase" checked />
              <span>Uppercase (A-Z)</span>
            </label>
            <label style="display: flex; align-items: center; gap: 8px;">
              <input type="checkbox" id="pwdLowercase" checked />
              <span>Lowercase (a-z)</span>
            </label>
            <label style="display: flex; align-items: center; gap: 8px;">
              <input type="checkbox" id="pwdNumbers" checked />
              <span>Numbers (0-9)</span>
            </label>
            <label style="display: flex; align-items: center; gap: 8px;">
              <input type="checkbox" id="pwdSymbols" />
              <span>Symbols (!@#$%)</span>
            </label>
          </div>

          <div class="pwd-form-group">
            <label class="pwd-form-label">Generated Password</label>
            <div style="display: flex; gap: 8px;">
              <input type="text" class="pwd-form-input" id="pwdGenerated" readonly />
              <button class="pwd-btn" id="pwdCopyGenerated">üìã Copy</button>
            </div>
            <div class="pwd-password-strength">
              <div class="pwd-strength-fill" id="pwdStrengthIndicator"></div>
            </div>
          </div>

          <div style="display: flex; gap: 8px;">
            <button class="pwd-btn primary" id="pwdGenerateNew">üé≤ Generate New</button>
            <button class="pwd-btn success" id="pwdSaveGenerated">üíæ Save to Vault</button>
          </div>
        </div>

        <div class="pwd-card">
          <div class="pwd-card-header">
            <div class="pwd-card-title">
              <span class="pwd-card-icon">üí°</span>
              Password Tips
            </div>
          </div>
          <ul style="color: var(--ink); font-size: 14px; line-height: 1.5;">
            <li>Use at least 12 characters</li>
            <li>Include uppercase, lowercase, numbers, and symbols</li>
            <li>Avoid common words or patterns</li>
            <li>Use a unique password for each account</li>
            <li>Consider using a password manager</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- User Passwords Tab -->
    <div class="pwd-tab-content" data-panel="users" style="display: none;">
      <div class="pwd-card">
        <div class="pwd-card-header">
          <div class="pwd-card-title">
            <span class="pwd-card-icon">üë•</span>
            User Account Management
          </div>
        </div>
        <div class="pwd-card-desc">Manage passwords for user accounts in the system</div>

        <div class="pwd-form-group">
          <label class="pwd-form-label">Select User</label>
          <select class="pwd-form-input" id="pwdUserSelect">
            <option value="">Choose a user...</option>
            <option value="admin">Admin User</option>
            <option value="user1">Regular User 1</option>
            <option value="user2">Regular User 2</option>
          </select>
        </div>

        <div style="display: flex; gap: 8px;">
          <button class="pwd-btn warning" id="pwdResetUserPassword">üîÑ Reset Password</button>
          <button class="pwd-btn" id="pwdChangeUserPassword">‚úèÔ∏è Change Password</button>
        </div>

        <div style="margin-top: 20px; padding: 16px; background: var(--bg); border-radius: 8px; border: 1px solid var(--line);">
          <strong>Note:</strong> User password management requires admin privileges and proper authentication setup.
        </div>
      </div>
    </div>

    <!-- Services Tab -->
    <div class="pwd-tab-content" data-panel="services" style="display: none;">
      <div class="pwd-card">
        <div class="pwd-card-header">
          <div class="pwd-card-title">
            <span class="pwd-card-icon">üîß</span>
            Service Credentials
          </div>
        </div>
        <div class="pwd-card-desc">Manage passwords and API keys for external services</div>

        <div id="pwdServicesList">
          <div class="pwd-entry">
            <div class="pwd-entry-icon">üêò</div>
            <div class="pwd-entry-info">
              <div class="pwd-entry-name">PostgreSQL Database</div>
              <div class="pwd-entry-meta">Last rotated: Never ‚Ä¢ Status: Needs Update</div>
            </div>
            <div class="pwd-entry-actions">
              <button class="pwd-btn" onclick="alert('Service password rotation coming soon')">üîÑ Rotate</button>
            </div>
          </div>

          <div class="pwd-entry">
            <div class="pwd-entry-icon">üê∞</div>
            <div class="pwd-entry-info">
              <div class="pwd-entry-name">Redis Cache</div>
              <div class="pwd-entry-meta">Last rotated: Never ‚Ä¢ Status: Needs Update</div>
            </div>
            <div class="pwd-entry-actions">
              <button class="pwd-btn" onclick="alert('Service password rotation coming soon')">üîÑ Rotate</button>
            </div>
          </div>
        </div>

        <button class="pwd-btn primary" id="pwdAddService" onclick="alert('Add service functionality coming soon')">‚ûï Add Service</button>
      </div>
    </div>

    <!-- Policies Tab -->
    <div class="pwd-tab-content" data-panel="policies" style="display: none;">
      <div class="pwd-card">
        <div class="pwd-card-header">
          <div class="pwd-card-title">
            <span class="pwd-card-icon">üìã</span>
            Password Policies
          </div>
        </div>
        <div class="pwd-card-desc">Configure password requirements and security policies</div>

        <div class="pwd-form-group">
          <label class="pwd-form-label">Minimum Length</label>
          <input type="number" class="pwd-form-input" id="pwdMinLength" value="8" min="6" max="64" />
        </div>

        <div class="pwd-form-group">
          <label style="display: flex; align-items: center; gap: 8px;">
            <input type="checkbox" id="pwdRequireUppercase" checked />
            <span>Require uppercase letters</span>
          </label>
          <label style="display: flex; align-items: center; gap: 8px;">
            <input type="checkbox" id="pwdRequireLowercase" checked />
            <span>Require lowercase letters</span>
          </label>
          <label style="display: flex; align-items: center; gap: 8px;">
            <input type="checkbox" id="pwdRequireNumbers" checked />
            <span>Require numbers</span>
          </label>
          <label style="display: flex; align-items: center; gap: 8px;">
            <input type="checkbox" id="pwdRequireSymbols" />
            <span>Require symbols</span>
          </label>
        </div>

        <button class="pwd-btn primary" id="pwdSavePolicies" onclick="savePolicies()">üíæ Save Policies</button>
      </div>
    </div>

    <!-- Audit Tab -->
    <div class="pwd-tab-content" data-panel="audit" style="display: none;">
      <div class="pwd-card">
        <div class="pwd-card-header">
          <div class="pwd-card-title">
            <span class="pwd-card-icon">üìà</span>
            Password Audit Log
          </div>
        </div>
        <div class="pwd-card-desc">Track password changes, access, and security events</div>

        <div id="pwdAuditLog" style="max-height: 400px; overflow-y: auto; background: var(--bg); border: 1px solid var(--line); border-radius: 8px; padding: 12px;">
          <div style="text-align: center; color: var(--muted); padding: 20px;">
            <div style="font-size: 32px; margin-bottom: 16px;">üìã</div>
            <div>Audit logging will be available once the system is fully integrated.</div>
          </div>
        </div>

        <div style="margin-top: 16px; display: flex; gap: 8px;">
          <button class="pwd-btn" id="pwdRefreshAudit" onclick="refreshAudit()">üîÑ Refresh</button>
          <button class="pwd-btn" id="pwdExportAudit" onclick="exportAudit()">üì• Export</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modals -->
  <div class="pwd-modal" id="pwdCreateModal">
    <div class="pwd-modal-content">
      <div class="pwd-modal-header">
        <div class="pwd-modal-title">Create Password Entry</div>
        <button class="pwd-modal-close" id="pwdCreateModalClose">√ó</button>
      </div>
      <div class="pwd-modal-body">
        <div class="pwd-form-group">
          <label class="pwd-form-label">Name</label>
          <input type="text" class="pwd-form-input" id="pwdEntryName" placeholder="e.g., Gmail Account" />
        </div>

        <div class="pwd-form-group">
          <label class="pwd-form-label">Username/Email</label>
          <input type="text" class="pwd-form-input" id="pwdEntryUsername" placeholder="username or email" />
        </div>

        <div class="pwd-form-group">
          <label class="pwd-form-label">Password</label>
          <input type="password" class="pwd-form-input" id="pwdEntryPassword" />
        </div>

        <div class="pwd-form-group">
          <label class="pwd-form-label">Category</label>
          <select class="pwd-form-input" id="pwdEntryCategory">
            <option value="personal">Personal</option>
            <option value="work">Work</option>
            <option value="finance">Finance</option>
            <option value="social">Social</option>
            <option value="other">Other</option>
          </select>
        </div>

        <div class="pwd-form-group">
          <label class="pwd-form-label">URL</label>
          <input type="url" class="pwd-form-input" id="pwdEntryUrl" placeholder="https://..." />
        </div>

        <div class="pwd-form-group">
          <label class="pwd-form-label">Notes</label>
          <textarea class="pwd-form-input" id="pwdEntryNotes" rows="3" placeholder="Additional notes..."></textarea>
        </div>

        <div style="display: flex; gap: 8px; justify-content: flex-end;">
          <button class="pwd-btn" id="pwdCreateCancel">Cancel</button>
          <button class="pwd-btn primary" id="pwdCreateSave">üíæ Save Entry</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Notifications -->
  <div class="pwd-toast" id="pwdToast"></div>

  <script>
    // Initialize the passwords console when the page loads
    document.addEventListener('DOMContentLoaded', function() {
      console.log('üîê Initializing Standalone Passwords Console...');

      // Load saved data
      loadPasswordData();

      // Tab switching
      document.querySelectorAll('.pwd-tab').forEach(tab => {
        tab.addEventListener('click', function() {
          const tabName = this.dataset.tab;

          // Update active tab
          document.querySelectorAll('.pwd-tab').forEach(t => t.classList.remove('active'));
          this.classList.add('active');

          // Show/hide content
          document.querySelectorAll('.pwd-tab-content').forEach(content => {
            content.style.display = content.dataset.panel === tabName ? 'block' : 'none';
          });
        });
      });

      // Password generator
      const lengthSlider = document.getElementById('pwdLength');
      const lengthValue = document.getElementById('pwdLengthValue');

      if (lengthSlider && lengthValue) {
        lengthSlider.addEventListener('input', function() {
          lengthValue.textContent = this.value;
        });
      }

      // Generate password button
      document.getElementById('pwdGenerateNew')?.addEventListener('click', function() {
        const length = parseInt(document.getElementById('pwdLength').value) || 16;
        const uppercase = document.getElementById('pwdUppercase').checked;
        const lowercase = document.getElementById('pwdLowercase').checked;
        const numbers = document.getElementById('pwdNumbers').checked;
        const symbols = document.getElementById('pwdSymbols').checked;

        const password = generatePassword(length, { uppercase, lowercase, numbers, symbols });
        document.getElementById('pwdGenerated').value = password;
        updateStrengthIndicator(password);
      });

      // Copy generated password
      document.getElementById('pwdCopyGenerated')?.addEventListener('click', function() {
        const password = document.getElementById('pwdGenerated').value;
        if (password) {
          navigator.clipboard.writeText(password).then(() => {
            showToast('Password copied!', 'success');
          }).catch(() => {
            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = password;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            showToast('Password copied!', 'success');
          });
        }
      });

      // Save generated password
      document.getElementById('pwdSaveGenerated')?.addEventListener('click', function() {
        const password = document.getElementById('pwdGenerated').value;
        if (password) {
          // Populate the create modal with the generated password
          document.getElementById('pwdEntryPassword').value = password;
          document.getElementById('pwdCreateModal').classList.add('show');
        }
      });

      // Modal functionality
      document.getElementById('pwdCreate')?.addEventListener('click', function() {
        document.getElementById('pwdCreateModal').classList.add('show');
      });

      document.getElementById('pwdCreateModalClose')?.addEventListener('click', function() {
        document.getElementById('pwdCreateModal').classList.remove('show');
      });

      document.getElementById('pwdCreateCancel')?.addEventListener('click', function() {
        document.getElementById('pwdCreateModal').classList.remove('show');
      });

      document.getElementById('pwdCreateSave')?.addEventListener('click', function() {
        savePasswordEntry();
      });

      // Other buttons
      document.getElementById('pwdGenerate')?.addEventListener('click', function() {
        // Switch to generator tab and generate
        document.querySelector('[data-tab="generator"]').click();
        setTimeout(() => {
          document.getElementById('pwdGenerateNew').click();
        }, 100);
      });

      document.getElementById('pwdImport')?.addEventListener('click', function() {
        alert('Password import functionality coming soon!');
      });

      document.getElementById('pwdAudit')?.addEventListener('click', function() {
        document.querySelector('[data-tab="audit"]').click();
      });

      console.log('‚úÖ Standalone Passwords Console initialized');
    });

    // Core functions
    function generatePassword(length, options) {
      const chars = {
        uppercase: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
        lowercase: 'abcdefghijklmnopqrstuvwxyz',
        numbers: '0123456789',
        symbols: '!@#$%^&*()_+-=[]{}|;:,.<>?'
      };

      let charset = '';
      if (options.uppercase) charset += chars.uppercase;
      if (options.lowercase) charset += chars.lowercase;
      if (options.numbers) charset += chars.numbers;
      if (options.symbols) charset += chars.symbols;

      if (!charset) charset = chars.lowercase;

      let password = '';
      for (let i = 0; i < length; i++) {
        password += charset.charAt(Math.floor(Math.random() * charset.length));
      }

      return password;
    }

    function updateStrengthIndicator(password) {
      const indicator = document.getElementById('pwdStrengthIndicator');
      if (!indicator) return;

      let score = 0;
      if (password.length >= 8) score++;
      if (password.length >= 12) score++;
      if (/[A-Z]/.test(password)) score++;
      if (/[a-z]/.test(password)) score++;
      if (/[0-9]/.test(password)) score++;
      if (/[^A-Za-z0-9]/.test(password)) score++;

      indicator.className = 'pwd-strength-fill';
      if (score <= 2) {
        indicator.classList.add('pwd-strength-weak');
      } else if (score <= 4) {
        indicator.classList.add('pwd-strength-medium');
      } else {
        indicator.classList.add('pwd-strength-strong');
      }
    }

    function showToast(message, type = 'success') {
      const toast = document.getElementById('pwdToast');
      if (!toast) return;

      toast.textContent = message;
      toast.className = `pwd-toast ${type} show`;

      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    function savePasswordEntry() {
      const name = document.getElementById('pwdEntryName').value.trim();
      const username = document.getElementById('pwdEntryUsername').value.trim();
      const password = document.getElementById('pwdEntryPassword').value;
      const category = document.getElementById('pwdEntryCategory').value;
      const url = document.getElementById('pwdEntryUrl').value.trim();
      const notes = document.getElementById('pwdEntryNotes').value.trim();

      if (!name || !password) {
        showToast('Name and password are required', 'error');
        return;
      }

      // Get existing entries
      let entries = [];
      try {
        const stored = localStorage.getItem('standalone-passwords');
        if (stored) entries = JSON.parse(stored);
      } catch (e) {
        console.warn('Failed to load existing entries:', e);
      }

      // Add new entry
      const entry = {
        id: Date.now().toString(),
        name,
        username,
        password,
        category,
        url,
        notes,
        created: new Date().toISOString()
      };

      entries.push(entry);

      // Save to localStorage
      try {
        localStorage.setItem('standalone-passwords', JSON.stringify(entries));
        showToast('Password saved!', 'success');

        // Close modal and refresh display
        document.getElementById('pwdCreateModal').classList.remove('show');
        loadPasswordData();

        // Clear form
        document.getElementById('pwdEntryName').value = '';
        document.getElementById('pwdEntryUsername').value = '';
        document.getElementById('pwdEntryPassword').value = '';
        document.getElementById('pwdEntryCategory').value = 'personal';
        document.getElementById('pwdEntryUrl').value = '';
        document.getElementById('pwdEntryNotes').value = '';
      } catch (e) {
        showToast('Failed to save password', 'error');
      }
    }

    function loadPasswordData() {
      let entries = [];
      try {
        const stored = localStorage.getItem('standalone-passwords');
        if (stored) entries = JSON.parse(stored);
      } catch (e) {
        console.warn('Failed to load password entries:', e);
      }

      // Update stats
      document.getElementById('pwdTotalCount').textContent = entries.length;
      const strongCount = entries.filter(entry =>
        checkPasswordStrength(entry.password) === 'strong'
      ).length;
      document.getElementById('pwdStrongCount').textContent = strongCount;

      // Render entries
      const container = document.getElementById('pwdEntries');
      if (!container) return;

      if (entries.length === 0) {
        container.innerHTML = `
          <div class="pwd-card">
            <div style="text-align: center; padding: 40px; color: var(--muted);">
              <div style="font-size: 48px; margin-bottom: 16px;">üîê</div>
              <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">No Passwords Yet</div>
              <div style="margin-bottom: 20px;">Create your first password entry to get started</div>
              <button class="pwd-btn primary" onclick="document.getElementById('pwdCreate').click()">‚ûï Create Entry</button>
            </div>
          </div>
        `;
        return;
      }

      container.innerHTML = entries.map((entry, index) => `
        <div class="pwd-entry">
          <div class="pwd-entry-icon">${getCategoryIcon(entry.category)}</div>
          <div class="pwd-entry-info">
            <div class="pwd-entry-name">${escapeHtml(entry.name)}</div>
            <div class="pwd-entry-meta">
              ${entry.username ? escapeHtml(entry.username) : ''}
              ${entry.url ? ` ‚Ä¢ ${escapeHtml(entry.url)}` : ''}
              ${entry.category ? ` ‚Ä¢ ${entry.category}` : ''}
            </div>
          </div>
          <div class="pwd-entry-actions">
            <button class="pwd-btn" onclick="copyPassword('${entry.password}')">üìã</button>
            <button class="pwd-btn" onclick="deletePassword('${entry.id}')">üóëÔ∏è</button>
          </div>
        </div>
      `).join('');
    }

    function getCategoryIcon(category) {
      const icons = {
        personal: 'üë§',
        work: 'üíº',
        finance: 'üí∞',
        social: 'üåê',
        other: 'üîê'
      };
      return icons[category] || 'üîê';
    }

    function checkPasswordStrength(password) {
      let score = 0;
      if (password.length >= 8) score++;
      if (password.length >= 12) score++;
      if (/[A-Z]/.test(password)) score++;
      if (/[a-z]/.test(password)) score++;
      if (/[0-9]/.test(password)) score++;
      if (/[^A-Za-z0-9]/.test(password)) score++;

      if (score <= 2) return 'weak';
      if (score <= 4) return 'medium';
      return 'strong';
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Global functions for onclick handlers
    window.copyPassword = function(password) {
      navigator.clipboard.writeText(password).then(() => {
        showToast('Password copied!', 'success');
      }).catch(() => {
        // Fallback
        const textArea = document.createElement('textarea');
        textArea.value = password;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        showToast('Password copied!', 'success');
      });
    };

    window.deletePassword = function(id) {
      if (!confirm('Are you sure you want to delete this password entry?')) return;

      let entries = [];
      try {
        const stored = localStorage.getItem('standalone-passwords');
        if (stored) entries = JSON.parse(stored);
      } catch (e) {}

      entries = entries.filter(entry => entry.id !== id);

      try {
        localStorage.setItem('standalone-passwords', JSON.stringify(entries));
        loadPasswordData();
        showToast('Password deleted', 'success');
      } catch (e) {
        showToast('Failed to delete password', 'error');
      }
    };

    window.savePolicies = function() {
      showToast('Password policies saved!', 'success');
    };

    window.refreshAudit = function() {
      showToast('Audit log refreshed', 'success');
    };

    window.exportAudit = function() {
      const data = localStorage.getItem('standalone-passwords') || '[]';
      const blob = new Blob([data], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `passwords-export-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
      showToast('Passwords exported!', 'success');
    };
  </script>
</body>
</html>
